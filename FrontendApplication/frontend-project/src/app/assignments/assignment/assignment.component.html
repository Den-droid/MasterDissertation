<div class="main-content">
  <h1 class="mb-4">
    <i class="fa-solid fa-clipboard-list me-2"></i> Виконання завдання
  </h1>

  <div class="card shadow-sm border-0 mb-4">
    <div class="card-body">

      <h5 class="card-title mb-3">Завдання</h5>
      <p class="card-text">
        {{assignmentDto?.hint}}
      </p>

      <p class="text-muted">
        @if(assignmentDto && isRestrictionNAttempts()){
        <i class="fa-solid fa-hourglass-half me-2"></i>
        Залишилось спроб:
        <span class="fw-bold">
          {{assignmentDto.attemptsRemaining}}
        </span>
        }
        @if(assignmentDto && isRestrictionDeadline()){
        <i class="fa-solid fa-calendar-alt me-2"></i>
        Дедлайн надсилання відповідей:
        <span class="fw-bold">
          {{assignmentDto.deadline}}
        </span>
        }
        @if(assignmentDto && isRestrictionAttemptInNMinutes()){
        <i class="fa-solid fa-redo me-2"></i>
        Наступна відповідь може бути надіслана:
        <span class="fw-bold">
          @if(isNextAttemptTimeAfterNow()){
          {{assignmentDto.nextAttemptTime}}
          }
          @else {
          зараз
          }
        </span>
        }
      </p>

      <form [formGroup]="form">
        <div class="row g-3 mb-3" formArrayName="variables">
          @for (i of variablesIndices; track i) {
          <div class="col-md-4">
            <label [for]="'inputVariable' + (i + 1)" class="form-label">
              {{ 'x' + (i + 1) }}
            </label>

            <input type="text" class="form-control" [id]="'inputVariable' + (i + 1)"
              [placeholder]="'Введіть x' + (i + 1)" [formControlName]="i"
              [readonly]="disableInputsAndButtons() || isAnswersMode" />

            @if (variables.at(i).errors?.['required'] && (variables.at(i).touched || variables.at(i).dirty) &&
            !(disableInputsAndButtons() || isAnswersMode)) {
            <div class="text-danger mt-1">{{variablesErrorRequired}}</div>
            }
            @if (variables.at(i).errors?.['pattern'] && (variables.at(i).touched || variables.at(i).dirty) &&
            !(disableInputsAndButtons() || isAnswersMode)) {
            <div class="text-danger mt-1">{{variablesErrorNotNumber}}</div>
            }
          </div>
          }

        </div>
      </form>

      @if(showAnswerNotCorrect()){
      <div class="alert alert-danger">
        Ваша відповідь неправильна. Значення функції для ваших змінних: {{assignmentResponseDto.result}}
      </div>
      }
      @if(showAnswerCorrect()){
      <div class="alert alert-success">
        Ваша відповідь правильна. Значення функції для ваших змінних: {{assignmentResponseDto.result}}.
        Натисніть кнопку Завершити, щоб завершити виконання завдання.
      </div>
      }
      @if(showErrorMessage()){
      <div class="alert alert-danger">
        Ви більше не можете відправити відповідь. <br>
        Причина:
        @if(isRestrictionNAttempts()){
        <span class="fw-bold">У вас залишилось 0 спроб</span>
        <br>
        }
        @if(isRestrictionDeadline()){
        <span class="fw-bold">Минув дедлайн надання відповідей</span>
        <br>
        }
        Натисніть кнопку Завершити, щоб завершити виконання завдання.
      </div>
      }

      <div class="d-flex justify-content-between gap-2 mt-3">
        <button type="button" class="btn btn-secondary" (click)="goBack()">
          <i class="fa-solid fa-arrow-left me-1"></i> Назад
        </button>
        <div class="d-flex gap-2">
          <button class="btn btn-primary" (click)="answer()" [disabled]="disableInputsAndButtons() || isAnswersMode">
            <i class="fa-solid fa-paper-plane me-1"></i> Дати відповідь
          </button>
          <button class="btn btn-success" (click)="finish()" [disabled]="isAnswersMode">
            <i class="fa-solid fa-check me-1"></i> Завершити
          </button>
        </div>
      </div>

      <div class="accordion mt-4" id="assignmentAccordion">
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingOne">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
              data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
              Попередні спроби
            </button>
          </h2>
          <div id="collapseOne" class="accordion-collapse collapse" aria-labelledby="headingOne"
            data-bs-parent="#assignmentAccordion">
            <div class="accordion-body">
              @for (previousAnswer of previousAnswersDto; track previousAnswer) {
              <div>
                <strong>{{previousAnswer.numberOfAnswer + '. '}}</strong>
                Введена відповідь: <strong>{{previousAnswer.answer}}</strong>.
                Значення функції для цих значень: <strong>{{previousAnswer.result}}</strong>
              </div>
              }
              @if(previousAnswersDto.length === 0) {
              <strong>Попередніх відповідей не знайдено!</strong>
              }
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <div class="alert alert-info mt-4" role="alert">
    <i class="fa-solid fa-lightbulb me-2"></i>
    Підказка: уважно перевіряйте свої розрахунки перед тим, як дати відповідь.
  </div>

</div>
